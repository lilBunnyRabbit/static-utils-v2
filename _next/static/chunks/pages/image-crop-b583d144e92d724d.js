(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[394],{2115:function(e,t,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/image-crop",function(){return i(7368)}])},7368:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return f}});var r=i(5893);let a=e=>!!e&&"image"===e.type.split("/")[0];async function l(e){if(!a(e))throw Error("File not image.");return await new Promise((t,i)=>{let r=new Image;r.onload=()=>t(r),r.onerror=i,r.src=URL.createObjectURL(e)})}class n{static async fromFile(e){let t=await l(e);return new n(e,t)}static async fromList(e){if(!e)return[];let t=(FileList,Array.from(e));return await Promise.all(t.map(async e=>{let t=null;if(e instanceof File)t=e;else{if(!e||"file"!==e.kind)return;t=e.getAsFile()}return t?await n.fromFile(t).catch(e=>console.error(e)):null}).filter(Boolean))}static async fromClipboardEvent(e){var t;return await n.fromList(null===(t=e.clipboardData)||void 0===t?void 0:t.items)}static async fromChangeEvent(e){return await n.fromList(e.target.files)}static fromUpload(e){return async t=>n.fromChangeEvent(t).then(e).catch(e=>console.error(e))}constructor(e,t){this.file=e,this.image=t}}let o=e=>t=>{let i=t.target;if("max"in i&&void 0!==i.max){let e="string"==typeof i.max?Number.parseFloat(i.max):i.max;i.valueAsNumber>e&&(t.target.value=String(e))}if("min"in i&&void 0!==i.min){let e="string"==typeof i.min?Number.parseFloat(i.min):i.min;i.valueAsNumber<e&&(t.target.value=String(e))}return e&&e(t)};var s=i(7294);let c=s.forwardRef((e,t)=>{let{label:i,state:a,onInput:l,...n}=e;return(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[i&&(0,r.jsx)("label",{children:i}),(0,r.jsx)("input",{type:"number",ref:t,...a&&{value:void 0===a[0]||isNaN(a[0])?"":a[0],onChange:e=>a[1](isNaN(e.target.valueAsNumber)?void 0:e.target.valueAsNumber)},onInput:o(l),...n})]})});c.displayName="NumberInput";let h=e=>{let{children:t}=e;return(0,r.jsxs)("div",{className:"grid grid-cols-[256px,1fr] min-h-screen",children:[(0,r.jsx)("div",{className:"relative p-4 bg-zinc-700",children:t[0]}),(0,r.jsx)("div",{className:"relative p-4 bg-zinc-900",children:t[1]})]})};var u=new class{start(e){let{image:t,canvas:i}=e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a={original:i.original.getContext("2d"),crop:i.crop.getContext("2d")};if(!a.original||!a.crop)return;i.original.width=t.width,i.original.height=t.height,a.original.clearRect(0,0,i.original.width,i.original.height),a.original.drawImage(t,0,0);let l=this.getCropLimits(a.original,255*(r.alphaLimit||0)/100);return a.original.fillStyle=r.color||"#ff0000",!function(e,t){let{top:i,left:r,right:a,bottom:l}=t;e.beginPath(),e.moveTo(0,0),e.lineTo(e.canvas.width,0),e.lineTo(e.canvas.width,e.canvas.height),e.lineTo(0,e.canvas.height),e.lineTo(0,0),e.closePath(),e.moveTo(r,i),e.lineTo(r,l),e.lineTo(a,l),e.lineTo(a,i),e.lineTo(r,i),e.closePath(),e.fill()}(a.original,l),i.crop.width=l.right-l.left,i.crop.height=l.bottom-l.top,a.crop.clearRect(0,0,i.crop.width,i.crop.height),a.crop.drawImage(t,l.left,l.top,i.crop.width,i.crop.height,0,0,i.crop.width,i.crop.height),{original:{width:i.original.width,height:i.original.height},crop:{width:i.crop.width,height:i.crop.height}}}getCropLimits(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=e.canvas,r=e.getImageData(0,0,i.width,i.height).data,a=(e,a)=>r[(a*i.width+e)*4+3]<=t,l=(()=>{for(let e=0;e<i.height;e++)for(let t=0;t<i.width;t++)if(!a(t,e))return e;return 0})(),n=(e=>{for(let t=i.width-1;t>=0;t--)for(let r=e;r<i.height;r++)if(!a(t,r))return t===i.width?i.width:t+1;return i.width})(l),o=(e=>{for(let t=i.height-1;t>=0;t--)for(let r=0;r<e;r++)if(!a(r,t))return t===i.height?i.height:t+1;return i.height})(n),s=((e,t)=>{for(let r=0;r<i.width;r++)for(let i=e;i<t;i++)if(!a(r,i))return r;return 0})(l,o);return{top:l,bottom:o,left:s,right:n}}};function f(){var e;let[t,i]=s.useState(),[a,l]=s.useState(0),[o,f]=s.useState("#ff0000"),[g,d]=s.useState(),m=s.useRef(null),p=s.useRef(null);return e=e=>i(e[0]),s.useEffect(()=>{let t=!0,i=async i=>{t&&(t=!1,await n.fromClipboardEvent(i).then(e).catch(e=>{console.error(e)}),t=!0)};return document.addEventListener("paste",i),()=>{document.removeEventListener("paste",i)}},[e]),s.useEffect(()=>{if(!t)return;let e=u.start({image:t.image,canvas:{original:m.current,crop:p.current}},{alphaLimit:a,color:o});d(e)},[t,a,o]),(0,r.jsxs)(h,{children:[(0,r.jsxs)("div",{className:"relative w-full h-full flex flex-col justify-between",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,r.jsx)(c,{className:"w-full text-black pl-2",label:"Alpha",min:0,max:100,state:[a,l]}),(0,r.jsx)("input",{type:"color",value:o,onChange:e=>f(e.target.value)}),g&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{children:["ORIGINAL: ",g.original.width,"x",g.original.height]}),(0,r.jsxs)("div",{children:["CROP: ",g.crop.width,"x",g.crop.height]})]})]}),(0,r.jsx)("input",{type:"file",accept:"image/*",onChange:n.fromUpload(e=>i(e[0]))})]}),(0,r.jsxs)("div",{className:"relative w-full h-full grid grid-cols-[1fr,1fr] gap-4 justify-center place-items-center",children:[(0,r.jsx)("canvas",{ref:m,className:"border border-red-400 object-contain max-w-full max-h-full"}),(0,r.jsx)("canvas",{ref:p,className:"border border-red-400 object-contain max-w-full max-h-full"})]})]})}}},function(e){e.O(0,[774,888,179],function(){return e(e.s=2115)}),_N_E=e.O()}]);